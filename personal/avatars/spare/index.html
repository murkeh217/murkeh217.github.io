<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>MK VRM â€“ White Grid Floor</title>
<style>
  body { margin:0; overflow:hidden; background:#000; }
  canvas { display:block; }
</style>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.180.0/build/three.module.js",
    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.180.0/examples/jsm/",
    "@pixiv/three-vrm": "https://cdn.jsdelivr.net/npm/@pixiv/three-vrm@3.4.2/lib/three-vrm.module.js"
  }
}
</script>
</head>
<body>
<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
import { VRMLoaderPlugin, VRMUtils } from '@pixiv/three-vrm';

// ----- Renderer -----
const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// ----- Scene & Camera -----
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

const camera = new THREE.PerspectiveCamera(40, window.innerWidth/window.innerHeight, 0.1, 100);
camera.position.set(0, 2, 6);

const controls = new OrbitControls(camera, renderer.domElement);
controls.target.set(0, 1, 0);
controls.update();

// ----- Lighting -----
const keyLight = new THREE.DirectionalLight(0xffffff, 1.8);
keyLight.position.set(3, 6, 5);
scene.add(keyLight);
scene.add(new THREE.AmbientLight(0xffffff, 0.6));

// ----- White Grid Floor -----
const grid = new THREE.GridHelper(60, 60, 0xffffff, 0xffffff);
grid.material.opacity = 0.25;     // faint lines
grid.material.transparent = true;
scene.add(grid);

// ----- Loaders -----
const loader = new GLTFLoader();
loader.register(parser => new VRMLoaderPlugin(parser));

let vrmModel, glbModel;

// Load VRM model
loader.load('./MK.vrm', (gltf)=>{
  const vrm = gltf.userData.vrm;
  VRMUtils.removeUnnecessaryVertices(gltf.scene);
  vrm.scene.position.set(-1.5, 0, 0);
  vrm.scene.traverse(o => o.frustumCulled = false);
  scene.add(vrm.scene);
  vrmModel = vrm;
});

// Load GLB model
const glbLoader = new GLTFLoader();
glbLoader.load('./MK.glb', (gltf)=>{
  glbModel = gltf.scene;
  glbModel.position.set(1.5, 0, 0);
  scene.add(glbModel);
});

// ----- Resize -----
window.addEventListener('resize', ()=>{
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

// ----- Animation Loop -----
const clock = new THREE.Clock();
function animate(){
  requestAnimationFrame(animate);
  const delta = clock.getDelta();

  // Slow rotation
  if (vrmModel) {
    vrmModel.scene.rotation.y += delta * 0.5;
    vrmModel.update(delta);
  }
  if (glbModel) glbModel.rotation.y -= delta * 0.5;

  renderer.render(scene, camera);
}
animate();
</script>
</body>
</html>
