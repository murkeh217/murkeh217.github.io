<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>MK Avatar</title>
<link rel="stylesheet" href="./style.css">
</style>
</head>
<body>
<script type="module">
  import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.157/build/three.module.js';
  import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.157/examples/jsm/controls/OrbitControls.js';
  import { VRMLoaderPlugin } from 'https://cdn.jsdelivr.net/npm/@pixiv/three-vrm@latest/lib/three-vrm.module.js';

  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x222222);

  const camera = new THREE.PerspectiveCamera(35, window.innerWidth/window.innerHeight, 0.1, 100);
  camera.position.set(0, 1.4, 2.5);

  const renderer = new THREE.WebGLRenderer({antialias: true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Light
  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(1, 1, 1);
  scene.add(light);
  scene.add(new THREE.AmbientLight(0xffffff, 0.3));

  // Controls
  const controls = new OrbitControls(camera, renderer.domElement);
  controls.target.set(0, 1.4, 0);
  controls.update();

  // VRM Loader
  const loader = new THREE.GLTFLoader();
  loader.register(parser => new VRMLoaderPlugin(parser));

  loader.load(
      './MK.vrm',
      (gltf) => {
          const vrm = gltf.userData.vrm;
          scene.add(vrm.scene);
          console.log('VRM loaded:', vrm);
      },
      (progress) => console.log('Loading...', (progress.loaded / progress.total * 100).toFixed(2) + '%'),
      (error) => console.error(error)
  );

  window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
  });

  function animate() {
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
  }
  animate();
</script>
<!-- GLTFLoader needed by three-vrm -->
<script type="module" src="https://cdn.jsdelivr.net/npm/three@0.157/examples/jsm/loaders/GLTFLoader.js"></script>
</body>
</html>
